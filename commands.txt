echo hello SQL
psql --username=freecodecamp --dbname=postgres


\l
create database students;
\l
\c students
create table students();
create table majors();
create table courses();
create table majors_courses();
\d
alter table students add column student_id serial primary key;
alter table students add column first_name varchar(50) not null;
alter table students add column last_name varchar(50) not null;
alter table students add column major_id int;
alter table students add column gpa numeric(2,1);
\d students
alter table majors add column major_id serial primary key;
alter table majors add column major varchar(50) not null;
\d majors
alter table students add foreign key(major_id) references majors(major_id);
\d students
alter table courses add column course_id serial primary key;
alter table courses add column course varchar(100) not null;
\d courses
alter table majors_courses add column major_id int;
alter table majors_courses add foreign key(major_id) references majors(major_id);
alter table majors_courses add column course_id int;
alter table majors_courses add foreign key(course_id) references courses(course_id);
\d majors_courses
alter table majors_courses add primary key(major_id, course_id);
\d majors_courses
\d
\d majors
insert into majors(major) values('Database Administration');
select * from majors;
insert into courses(course) values('Data Structures and Algorithms');
select * from courses;
\d majors_courses
insert into majors_courses(major_id,course_id) values(1,1);
select * from majors_courses;
\d students
INSERT INTO students(first_name, last_name, major_id, gpa) VALUES('Rhea', 'Kellems', 1, 2.5);
select * from students;

split trem:
new:
touch insert_data.sh
chmod +x insert_data.sh
nano insert_data.sh
looks:
----------------------------------
#!/bin/bash
#Script to insert data from courses.csv and students.csv into students database
PSQL="psql -X --username=freecodecamp --dbname=students --no-align --tuples-only -c"
echo $($PSQL "TRUNCATE students, majors, courses, majors_courses")
cat courses.csv | while IFS="," read MAJOR COURSE
do
  if [[ $MAJOR != major ]]
  then
    # get major_id
    MAJOR_ID=$($PSQL "SELECT major_id FROM majors WHERE major='$MAJOR'")

    # if not found
    if [[ -z $MAJOR_ID ]]
    then
      # insert major
      INSERT_MAJOR_RESULT=$($PSQL "INSERT INTO majors(major) VALUES('$MAJOR')")
      if [[ $INSERT_MAJOR_RESULT == "INSERT 0 1" ]]
      then
        echo "Inserted into majors, $MAJOR"
      fi
      # get new major_id
      MAJOR_ID=$($PSQL "SELECT major_id FROM majors WHERE major='$MAJOR'")

    fi

    # get course_id
    COURSE_ID=$($PSQL "SELECT course_id FROM courses WHERE course='$COURSE'")

    # if not found
    if [[ -z $COURSE_ID ]]
    then
      # insert course
      INSERT_COURSE_RESULT=$($PSQL "INSERT INTO courses(course) VALUES('$COURSE')")
      if [[ $INSERT_COURSE_RESULT == "INSERT 0 1" ]]
      then
        echo "Inserted into courses, $COURSE"
      fi
      # get new course_id
        COURSE_ID=$($PSQL "SELECT course_id FROM courses WHERE course='$COURSE'")
    fi

    # insert into majors_courses
    INSERT_MAJORS_COURSES_RESULT=$($PSQL "INSERT INTO majors_courses(major_id, course_id) VALUES($MAJOR_ID, $COURSE_ID)")
    if [[ $INSERT_MAJORS_COURSES_RESULT == "INSERT 0 1" ]]
    then
      echo "Inserted into majors_courses, $MAJOR : $COURSE"
    fi

  fi
done

cat students.csv | while IFS="," read FIRST LAST MAJOR GPA
do
  if [[ $FIRST != "first_name" ]]
  then
    # get major_id
    MAJOR_ID=$($PSQL "SELECT major_id FROM majors WHERE major='$MAJOR'")


    # if not found
    if [[ -z $MAJOR_ID ]]
    then
      # set to null
      MAJOR_ID=null
    fi

    # insert student
    INSERT_STUDENT_RESULT=$($PSQL "INSERT INTO students(first_name, last_name, major_id, gpa) VALUES('$FIRST', '$LAST', $MAJOR_ID, $GPA)")
    if [[ $INSERT_STUDENT_RESULT == "INSERT 0 1" ]]
    then
      echo "Inserted into students, $FIRST $LAST"
    fi
  fi
done

----------------------------------

original:
select * from majors;
TRUNCATE majors;
TRUNCATE majors, students, majors_courses;
select * from majors;
select * from majors_courses;
select * from students;
select * from courses;
TRUNCATE courses, majors_courses;
select * from courses;

new:
./insert_data.sh
or:
select * from majors;
TRUNCATE majors, students, majors_courses;
select * from majors;
new:
./insert_data.sh
or:
select * from majors;
TRUNCATE majors, students, majors_courses;
select * from majors;
new:
./insert_data.sh
or:
TRUNCATE majors, students, majors_courses;
new:
./insert_data.sh
or:
select * from courses;
new:
./insert_data.sh
or:
select * from majors;
select * from courses;
select * from majors_courses;
new:
cp students.csv students_test.csv
or:
\d students
select * from students;
select * from majors;
select * from courses;
select * from majors_courses;
new:
ls
rm students_test.csv
rm courses_test.csv
ls
pg_dump --help
pg_dump --clean --create --inserts --username=freecodecamp students > students.sql































